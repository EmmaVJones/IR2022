---
title: "How to run automated assessment- Riverine"
author: "Emma Jones"
date: "October 14, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(readxl)
library(pins)
library(config)
#library(FSA)
#library(lubridate)
#library(magrittr)

# Bring in Assessment functions from app
#source('global.R')

# get configuration settings
conn <- config::get("connectionSettings")

# use API key to register board
board_register_rsconnect(key = conn$CONNECT_API_KEY,  #Sys.getenv("CONNECT_API_KEY"),
                          server = conn$CONNECT_SERVER)#Sys.getenv("CONNECT_SERVER"))

```

This document walks users through running the automated assessement for any given set of stations and waterbody type (riverine or lacustrine for now). Prior to this point, the user needs to have completed the necessary prerequisites of attributing stations with AU and WQS information. This dataset is a companion to the rivers and streams/lake assessment applications and is **NOT** final. The results cited in this table are identical to the app calculations and are meant for assessor review, QA, editing prior to sumbitting to WQA CEDS bulk data upload.

# Prerequisites
The user will have to have all conventionals data, water column metals, and sediment metals organized by Roger for the window. **Additionally, the CEDS EDAS data needs to be exported and available for use, including regional Bioassessment calls**. Last cycle's finalized regional assessment layer (shapefile with AUs) are the spatial component needed. Lastly, the assessor must have the stations bulk data upload table filled out to their requirements in order to run the assessment scripts. 

## Pin Data/Retrieve Data

Scripts to organize and pin data are in ../2.organizeMetadata/organizeStationMetadata_DRAFTforApplication.Rmd 

## Bring in Pinned data

Much faster method and makes sure data used by assessors is same for testing.

```{r pull pins}
conventionals <- pin_get("conventionals2022IRdraft", board = "rsconnect")
conventionals_distinct <- pin_get("conventionals-distinct-draft", board = "rsconnect")
stations2020IR <- pin_get("stations2020IR-sf-draft", board = "rsconnect")
VSCIresults <- pin_get("VSCIresults", board = "rsconnect")
VCPMI63results <- pin_get("VCPMI63results", board = "rsconnect")
VCPMI65results <- pin_get("VCPMI65results", board = "rsconnect")
WCmetals <- pin_get("WCmetals-2020IRfinal",  board = "rsconnect")
Smetals <- pin_get("Smetals-2020IRfinal",  board = "rsconnect")

```


# Workflow

The following steps complete the automated assessment.

#

# steps

pin conventionals, metals, benthics, wqs information, last cycle AU info (spatial)

user upload AU and station info (carry over only what is given to scripts, NA if nothing given)

script joins WQS info



